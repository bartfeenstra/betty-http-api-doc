#!/usr/bin/env bash

set -Eeuo pipefail

cd "$(dirname "$0")/.."

trap tear_down INT TERM EXIT

working_directory_path=$(mktemp -d)

function tear_down() {
    docker stop betty-test-nginx 1>/dev/null || true
    rm -r "$working_directory_path"
}

# Lint the shell scripts.
for file in ./bin/*; do
    shellcheck -x "$file"
done

# Test the Python code style.
flake8 --config ./flake8.ini ./betty

# Test the CSS code style.
./node_modules/.bin/stylelint "./**/*.css" "./**/*.sass" "./**/*.scss"

# Test the JS code style.
./node_modules/.bin/eslint "./**/*.js"

# Run unit tests with coverage.
coverage erase
coverage run -m nose2
coverage report -m
