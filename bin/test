#!/usr/bin/env bash

set -Eeuo pipefail

cd "$(dirname "$0")/.."

betty_npm_dir=$(python -c 'from betty import npm; print(npm.BETTY_INSTANCE_NPM_DIR)')
betty_dir=$(readlink -f "$(pwd)")

# Test the Python code style.
flake8 --ignore=E501 ./betty

# Test the CSS code style.
(cd "$betty_npm_dir" && ./node_modules/.bin/stylelint "$betty_dir/betty/resources/public/betty.css")

# Test the JS code style.
(cd "$betty_npm_dir" && node_modules/.bin/eslint "$betty_dir/betty/resources/**/*.js")

# Run unit tests with coverage.
coverage erase
coverage run -m nose2
coverage report -m
